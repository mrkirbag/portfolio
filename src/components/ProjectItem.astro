---
import "@/assets/projectItem.css"

interface Props {
    id: string;
    title: string;
    description: string;
    image: string;
    technologies: string[];
    github: string;
    link: string;
}

const { id, title, description, image, technologies, github, link } = Astro.props;
---

<div class="project-card glass-card-project" data-project-card>
    <div class="project-image">
        <img src={image} alt={title} loading="lazy" />
        
        <div class="project-overlay">
            <div class="project-links">
                <a href={github} target="_blank" class="project-btn">
                    <span data-key="projects.view_code">CÃ³digo</span>
                </a>
                <a href={link} target="_blank" class="project-btn">
                    <span data-key="projects.view_live">Demo</span>
                </a>
            </div>
        </div>
    </div>
    
    <div class="project-info">
        <div class="tech-tags">
            {technologies.map(tech => <span>{tech}</span>)}
        </div>
        <h3 data-key={`projects.items.${id}.title`}>{title}</h3>
        <p class="project-description" data-key={`projects.items.${id}.description`}>{description}</p>
    </div>
    
    <div class="card-glow"></div>
</div>

<script>
    import { gsap } from 'gsap';

    const cards = document.querySelectorAll('[data-project-card]');

    cards.forEach(card => {
        let isScrolling = false;
        let startX = 0;
        let startY = 0;

        const handleMove = (e: any) => {
            if (isScrolling) return;

            const rect = card.getBoundingClientRect();
            const isTouch = e.type.includes('touch');
            const clientX = isTouch ? e.touches[0].clientX : e.clientX;
            const clientY = isTouch ? e.touches[0].clientY : e.clientY;

            const x = clientX - rect.left;
            const y = clientY - rect.top;

            (card as HTMLElement).style.setProperty('--x', `${x}px`);
            (card as HTMLElement).style.setProperty('--y', `${y}px`);

            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            
            const sensitivity = isTouch ? 50 : 20; 
            const rotateX = (y - centerY) / sensitivity;
            const rotateY = (centerX - x) / sensitivity;

            gsap.to(card, {
                rotateX: rotateX,
                rotateY: rotateY,
                transformPerspective: 1000,
                duration: 0.4,
                ease: "power2.out"
            });
        };

        const handleLeave = () => {
            gsap.to(card, {
                rotateX: 0,
                rotateY: 0,
                duration: 0.7,
                ease: "power2.out"
            });
        };

        card.addEventListener('mousemove', handleMove);
        card.addEventListener('mouseleave', handleLeave);

        card.addEventListener('touchstart', (e: any) => {
            isScrolling = false;
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        }, { passive: true });

        card.addEventListener('touchmove', (e: any) => {
            const currentX = e.touches[0].clientX;
            const currentY = e.touches[0].clientY;

            const diffX = Math.abs(currentX - startX);
            const diffY = Math.abs(currentY - startY);

            if (diffY > diffX && diffY > 10) {
                isScrolling = true;
                handleLeave();
                return;
            }

            if (diffX > 10) {
                if (e.cancelable) e.preventDefault();
                handleMove(e);
            }
        }, { passive: false });

        card.addEventListener('touchend', () => {
            isScrolling = false;
            handleLeave();
        });

        card.addEventListener('contextmenu', (e: any) => {
            if (e.pointerType === 'touch') e.preventDefault();
        });
    });
</script>