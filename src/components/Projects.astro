---
import ProjectItem from './ProjectItem.astro';
import { projectsData } from '@/data/projects';

import es from '@/i18n/es.json';
import '@/assets/projects.css';

const t = es.projects;
---

<section id="projects-section">
    <div class="projects-container">
        <h2 class="section-title" data-key="projects.title">{t.title}</h2>
        
        <div class="projects-grid">
            {projectsData.map(project => (
                <ProjectItem 
                    id={project.id}
                    image={project.image}
                    technologies={project.technologies}
                    github={project.github}
                    link={project.link}
                    title={t.items[project.id as keyof typeof t.items].title}
                    description={t.items[project.id as keyof typeof t.items].description}
                />
            ))}
        </div>
    </div>
</section>

<script>

    import { gsap } from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';

    gsap.registerPlugin(ScrollTrigger);

    function initProjects() {
        const section = document.querySelector("#projects-section");
        const title = document.querySelector(".section-title");
        const cards = document.querySelectorAll(".glass-card-project");

        if (!section || !title || cards.length === 0) return;

        const mainTl = gsap.timeline({
            scrollTrigger: {
                trigger: section,
                start: "top 80%",
                end: "bottom 30%", 
                toggleActions: "play none none reverse",
            }
        });

        mainTl.to(title, {
            opacity: 1,
            y: 0,
            duration: 0.8,
            ease: "power2.out",
            startAt: { y: 30 }
        })
        .from(cards, {
            opacity: 0,
            y: 50,
            scale: 0.95,
            stagger: 0.15,
            duration: 0.8,
            ease: "power2.out"
        }, "-=0.4"); 

        cards.forEach((card, index) => {
            gsap.to(card, {
                y: "-=15    ",
                duration: 2,
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut",
                delay: index * 0.2
            });
        });
    }

    window.addEventListener('load', () => {
        setTimeout(initProjects, 50);
    });
    
</script>